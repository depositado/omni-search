/*
 *  omni-search - v1.0.0
 *  A UI element for global searches
 *  
 *
 *  Made by Pedro Catr√©
 *  Under MIT License
 */
!function(a){"use strict";function b(b,c){this.element=b,this.settings=a.extend({},u,c),this._defaults=u,this._name=t,this.init()}function c(b){var c=a(r.SELECTED_SEARCH_RESULT_SELECTOR);if(0!==c.length){c.removeClass(r.SELECTED_CLASS);var d=null;if(b===p.GOING_DOWN){var e=c.next(r.SEARCH_RESULT_SELECTOR);d=0!==e.length?e:a(r.SEARCH_RESULT_SELECTOR).first()}else if(b===p.GOING_UP){var f=c.prev(r.SEARCH_RESULT_SELECTOR);d=0!==f.length?f:a(r.SEARCH_RESULT_SELECTOR).last()}e=d.addClass(r.SELECTED_CLASS)}else e=a(r.SEARCH_RESULT_SELECTOR).first().addClass(r.SELECTED_CLASS);e.get(0).scrollIntoViewIfNeeded()}function d(b){var c=e(b);a(r.SEARCH_RESULTS_LIST_SELECTOR).html(c),a(r.SEARCH_RESULT_SELECTOR).first().addClass(r.SELECTED_CLASS)}function e(b){var c=a("<span></span>");return b.forEach(function(b){var d=n.SEARCH_RESULT_ELEMENT_TEMPLATE,e=b.searchElementImgUrl||r.DEFAULT_SEARCH_ELEMENT_ICON;d=d.replace("{search_element_icon}",e),d=d.replace("{default_search_element_icon}",r.DEFAULT_SEARCH_ELEMENT_ICON),d=d.replace("{title}",b.title);var f=a(d);f=f.data(b),c.append(f)}),c}function f(a){a=a.toLowerCase();var b=[],c="";s.map(function(d){c=JSON.stringify(d).toLowerCase(),c.match(a)&&b.push(d)}),d(b)}function g(a){switch(a){case o.UP_KEY:return p.GOING_UP;case o.DOWN_KEY:return p.GOING_DOWN;case o.ESCAPE_KEY:return p.ESCAPING;case o.ENTER_KEY:return p.SWITCHING;default:return!1}}function h(a){var b=a.data();"function"==typeof q&&q(b)}function i(){var b=a(r.OMNI_SEARCH_SELECTOR).find(r.SELECTED_SEARCH_RESULT_SELECTOR).first();h(b),k()}function j(a){var b=g(a.keyCode);switch(b){case p.GOING_UP:case p.GOING_DOWN:c(b);break;case p.ESCAPING:k();break;case p.SWITCHING:i()}}function k(){a(r.OMNI_SEARCH_SELECTOR).hide(),a(r.SEARCH_INPUT_SELECTOR).val("")}function l(){a(document).on("mousedown",r.SEARCH_RESULT_SELECTOR,function(){var b=a(this);h(b)}),a(document).on("blur",r.SEARCH_INPUT_SELECTOR,function(){k()}),a(document).on("keydown",r.SEARCH_INPUT_SELECTOR,function(b){a(r.OMNI_SEARCH_SELECTOR).is(":visible")&&j(b)}),a(document).on("keyup",r.SEARCH_INPUT_SELECTOR,function(b){var c=b.keyCode,e=g(c);switch(e){case p.GOING_DOWN:case p.GOING_UP:case p.ESCAPING:case p.SWITCHING:return;default:var h=a(this).val();""!==a.trim(h)?f(h):d(s)}})}function m(a){return a.append(n.MAIN_TEMPLATE),a}var n;!function(a){a[a.MAIN_TEMPLATE='<div class="omni-search" style="display: none;">\n\t\t\t\t\t<input type="text">\n\t\t\t\t\t<ul class="search-results-list">\n\t\t\t\t\t</ul>\n\t\t\t\t</div>']="MAIN_TEMPLATE",a[a.SEARCH_RESULT_ELEMENT_TEMPLATE='<li class="search-result">\n\t\t\t\t\t<span class="search-element-img-container">\n\t\t\t\t\t\t<img src="{search_element_icon}" onerror="this.src=\'{default_search_element_icon}\';">\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="title">{title}</span>\n\t\t\t\t</li>']="SEARCH_RESULT_ELEMENT_TEMPLATE"}(n||(n={}));var o;!function(a){a[a.DOWN_KEY=40]="DOWN_KEY",a[a.UP_KEY=38]="UP_KEY",a[a.ESCAPE_KEY=27]="ESCAPE_KEY",a[a.ENTER_KEY=13]="ENTER_KEY"}(o||(o={}));var p;!function(a){a[a.GOING_UP="going_up"]="GOING_UP",a[a.GOING_DOWN="going_down"]="GOING_DOWN",a[a.ESCAPING="escaping"]="ESCAPING",a[a.SWITCHING="switching"]="SWITCHING"}(p||(p={}));var q,r={DEFAULT_SEARCH_ELEMENT_ICON:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAMklEQVR4AWMgEkT9R4INWBUgKX0Q1YBXQYQCkhKEMDILogSnAhhEV4AGRqoCTEhkPAMAbO9DU+cdCDkAAAAASUVORK5CYII=",SELECTED_CLASS:"selected-search-result",SELECTED_SEARCH_RESULT_SELECTOR:".selected-search-result",SEARCH_ELEMENT_IMG_SELECTOR:".search-element-img-container img",OMNI_SEARCH_SELECTOR:".omni-search",SEARCH_RESULTS_LIST_SELECTOR:".omni-search .search-results-list",SEARCH_RESULT_SELECTOR:".search-result",SEARCH_INPUT_SELECTOR:'.omni-search input[type="text"]'},s=[],t="omniSearch",u={propertyName:"value"};a.extend(b.prototype,{init:function(){var b=a(this.element);m(b),l()},open:function(b,c){console.log(">> Show omni search"),a(r.OMNI_SEARCH_SELECTOR).show(),a(r.SEARCH_INPUT_SELECTOR).focus(),s=b,q=c,d(b)},close:k}),a.fn[t]=function(c){var d=arguments;if(void 0===c||"object"==typeof c)return this.each(function(){a.data(this,"plugin_"+t)||a.data(this,"plugin_"+t,new b(this,c))});if("string"==typeof c&&"_"!==c[0]&&"init"!==c){var e;return this.each(function(){var f=a.data(this,"plugin_"+t);f instanceof b&&"function"==typeof f[c]&&(e=f[c].apply(f,Array.prototype.slice.call(d,1))),"destroy"===c&&a.data(this,"plugin_"+t,null)}),void 0!==e?e:this}}}(jQuery);